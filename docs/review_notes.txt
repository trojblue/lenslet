Review notes for docs/20260124_sync_indicator_toolbar_plan.md

Overall
- Plan is well-scoped for two sprints, but a few edge cases, a11y needs, and state/test gaps should be made explicit. T2/T6/T7 are a bit bundled.

Missing or under-scoped work
- Add a ticket for accessibility + focus management (button semantics, aria-haspopup/expanded/controls, focus return on close, keyboard navigation).
- Add a ticket for dot color CSS tokens + card z-index/spacing tied to existing theme vars (avoid one-off colors).
- Add a ticket to define/maintain status copy for the card (sync/connection/error) so removing StatusBar pills doesn’t drop critical info.
- Add a ticket for timestamp ingestion: store `lastEditedAt` from SSE events, validate/parse server timestamps, and ignore stale replay.
- Add a ticket for a small pure helper + unit tests for indicator state derivation (precedence, 15‑minute hold, unstable triggers).

Oversized or ambiguous tasks (split suggested)
- T2 bundles render + placement + popover behavior + responsiveness; split into: indicator render/placement, popover behavior (outside click/Escape), and styling/responsive layout.
- T6 bundles precedence, 15‑minute hold, and unstable conditions; split into a helper (pure logic) and wiring/telemetry.
- T7 mixes event capture with formatting; split into “capture lastEditedAt from events” and “format/label in card.”

Unclear goals to tighten
- Define mapping for `connectionStatus` values like `idle/connecting` and how they interact with polling fallback for yellow.
- Specify what counts as “last edited” (item-updated only vs metrics-updated) and whether server timestamps or receipt time win.
- Clarify when to show `—` vs `0` for viewing/editing, and the exact hover/title text when presence is missing.
- Define long-sync age semantics for coalesced queue updates vs direct patches (start time source).

Validation gaps
- No explicit keyboard-only validation for the popover (tab, Escape, focus return).
- No check for 24h boundary formatting or invalid timestamps.
- No validation that long-sync triggers for both queue-based and direct inflight updates.
- No mobile/viewer-mode layout check (narrow toolbar + search drawer open).

Hidden dependencies and risks
- Toolbar already has click-outside handlers (filters); a new popover listener can conflict unless scoped.
- `pollingEnabled` and sync error sources live outside the toolbar; if not wired, yellow “unstable” won’t reflect fallback/pending errors.
- Event replay can surface old updates; if recent-edit flash uses receipt time, the purple state can mislead users.
- Removing StatusBar pills makes the card the only place for sync/connection info; consider a minimal tooltip or always-available label to avoid hidden state.

Suggested new tickets (concise)
- Add a11y + focus management for SyncIndicator popover.
- Add indicator state helper + unit tests (precedence, 15‑minute hold, unstable triggers).
- Add robust timestamp ingestion (parse/validate/ignore stale replay) for last-edited + recent-edit.
- Add responsive placement + z-index audit for toolbar popover (mobile + viewer).
